# E4App (Empatica E4 Android)

Minimal Android app using Jetpack Compose to stream electrodermal activity (EDA) either from a mock source or from an Empatica E4 (stubbed placeholder). Includes product flavors and a simple UI to start/stop streaming and display the latest value.

## Project layout

- app/src/main – shared UI, view model, and models
- app/src/mock – mock flavor data source (MockEdaSensor)
- app/src/e4 – E4 flavor placeholder (E4EdaSensor)

## Build variants

- mockDebug – uses MockEdaSensor (no hardware required)
- e4Debug – intended for real E4 integration (SDK wiring required)

## Requirements

- Android Studio Koala or newer
- JDK 17
- Min SDK 26

## Run (mock)

1. Open the project in Android Studio: e4-android
2. Select the mockDebug build variant
3. Run on device or emulator

The app shows a Start/Stop button and the latest EDA sample (µS) generated by a mock signal (~16 Hz).

## Empatica E4 integration (stub)

This repo contains a placeholder E4EdaSensor in app/src/e4/java/....
To integrate the real SDK:

1. Obtain the Empatica E4 Android SDK (and credentials) from Empatica.
2. Add the SDK dependency (AAR/Maven) to the e4 flavor or to app with e4Implementation where applicable.
3. Implement connection, device discovery, and EDA streaming in E4EdaSensor, mapping samples to the EdaSample type.
4. Handle permissions (Bluetooth, and possibly location if required by the SDK) and lifecycle.

Suggested responsibilities for E4EdaSensor:
- Initialize SDK with API key
- Scan for E4 devices and connect
- Subscribe to EDA stream callbacks
- Convert each callback to EdaSample(timestampMs, microsiemens) and invoke onSample
- Implement stopStreaming() to unsubscribe and disconnect

Note: This repo does not bundle Empatica’s proprietary SDK. Follow their license and documentation.

## InfluxDB (optional, future)

OkHttp is included and an `InfluxWriter` is provided to post line protocol to InfluxDB v2 `/api/v2/write`.
Configure in the app UI (on Android Emulator use `http://10.0.2.2:8086` to reach your Mac's localhost):

- Write to InfluxDB (checkbox)
- Base URL (e.g. `http://localhost:8086`)
- Org
- Bucket
- Token

Line protocol example:

eda,source=e4 value=5.123 1725880000000000000

## License

See LICENSE.md in the repository root. If missing, assume private/internal use.

## Testing and simulation

- Android Emulator: run the `mockDebug` variant to simulate EDA without hardware.
- No official Empatica E4 simulator: Empatica does not provide a public E4 device simulator; use the mock flavor or implement a CSV replay source if you want deterministic data.
- Quick InfluxDB v2 for local testing:

  ```bash
  docker run --rm -p 8086:8086 \
    -e DOCKER_INFLUXDB_INIT_MODE=setup \
    -e DOCKER_INFLUXDB_INIT_USERNAME=dev \
    -e DOCKER_INFLUXDB_INIT_PASSWORD=devpass \
    -e DOCKER_INFLUXDB_INIT_ORG=devorg \
    -e DOCKER_INFLUXDB_INIT_BUCKET=gsr_data \
    -e DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=devtoken \
    influxdb:2
  ```

  App settings (Emulator): Base URL `http://10.0.2.2:8086`, Org `devorg`, Bucket `gsr_data`, Token `devtoken`.
  On a physical device, use your Mac's LAN IP instead of localhost.
